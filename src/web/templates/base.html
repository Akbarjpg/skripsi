<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>
      {% block title %}Face Anti-Spoofing Attendance System{% endblock %}
    </title>

    <!-- Bootstrap 5 CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />

    <!-- Font Awesome Icons -->
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
      rel="stylesheet"
    />

    <!-- Custom CSS -->
    <style>
      :root {
        --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        --secondary-gradient: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        --success-gradient: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        --shadow-light: 0 4px 6px rgba(0, 0, 0, 0.07);
        --shadow-medium: 0 8px 25px rgba(0, 0, 0, 0.15);
        --shadow-heavy: 0 15px 35px rgba(0, 0, 0, 0.1);
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        line-height: 1.6;
        color: #333;
      }

      .gradient-bg {
        background: var(--primary-gradient);
        min-height: 100vh;
      }

      .card-modern {
        border: none;
        border-radius: 15px;
        box-shadow: var(--shadow-medium);
        backdrop-filter: blur(10px);
        background: rgba(255, 255, 255, 0.95);
      }

      .btn-gradient {
        background: var(--primary-gradient);
        border: none;
        border-radius: 8px;
        color: white;
        font-weight: 500;
        padding: 12px 24px;
        transition: all 0.3s ease;
      }

      .btn-gradient:hover {
        transform: translateY(-2px);
        box-shadow: var(--shadow-medium);
        color: white;
      }

      .navbar-brand {
        font-weight: 700;
        font-size: 1.5rem;
      }

      .form-control:focus {
        border-color: #667eea;
        box-shadow: 0 0 0 0.2rem rgba(102, 126, 234, 0.25);
      }

      .alert-modern {
        border: none;
        border-radius: 10px;
        box-shadow: var(--shadow-light);
      }

      .footer {
        background: #2c3e50;
        color: white;
        padding: 20px 0;
        margin-top: auto;
      }

      .loading-spinner {
        display: none;
      }

      .loading .loading-spinner {
        display: inline-block;
      }

      .loading .btn-text {
        display: none;
      }

      /* Animations */
      @keyframes fadeInUp {
        from {
          opacity: 0;
          transform: translateY(30px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .fade-in-up {
        animation: fadeInUp 0.6s ease;
      }

      /* Custom scrollbar */
      ::-webkit-scrollbar {
        width: 8px;
      }

      ::-webkit-scrollbar-track {
        background: #f1f1f1;
      }

      ::-webkit-scrollbar-thumb {
        background: var(--primary-gradient);
        border-radius: 4px;
      }

      ::-webkit-scrollbar-thumb:hover {
        background: #555;
      }
    </style>

    {% block extra_css %}{% endblock %}
  </head>
  <body class="d-flex flex-column min-vh-100">
    <!-- Navigation -->
    <nav
      class="navbar navbar-expand-lg navbar-dark"
      style="background: var(--primary-gradient)"
    >
      <div class="container">
        <a class="navbar-brand" href="{{ url_for('index') }}">
          <i class="fas fa-shield-alt me-2"></i>
          Face Anti-Spoofing
        </a>

        <button
          class="navbar-toggler"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#navbarNav"
        >
          <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarNav">
          <ul class="navbar-nav me-auto">
            <li class="nav-item">
              <a class="nav-link" href="{{ url_for('index') }}">
                <i class="fas fa-home me-1"></i>Home
              </a>
            </li>
            {% if session.user_id %}
            <li class="nav-item">
              <a class="nav-link" href="{{ url_for('attendance') }}">
                <i class="fas fa-calendar-check me-1"></i>Attendance
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="{{ url_for('dashboard') }}">
                <i class="fas fa-chart-bar me-1"></i>Dashboard
              </a>
            </li>
            {% endif %}
          </ul>

          <ul class="navbar-nav">
            {% if session.user_id %}
            <li class="nav-item dropdown">
              <a
                class="nav-link dropdown-toggle"
                href="#"
                id="navbarDropdown"
                role="button"
                data-bs-toggle="dropdown"
              >
                <i class="fas fa-user-circle me-1"></i>{{ session.full_name or
                session.username }}
              </a>
              <ul class="dropdown-menu">
                <li>
                  <a class="dropdown-item" href="{{ url_for('dashboard') }}">
                    <i class="fas fa-chart-bar me-2"></i>Dashboard
                  </a>
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li>
                  <a class="dropdown-item" href="{{ url_for('logout') }}">
                    <i class="fas fa-sign-out-alt me-2"></i>Logout
                  </a>
                </li>
              </ul>
            </li>
            {% else %}
            <li class="nav-item">
              <a class="nav-link" href="{{ url_for('login') }}">
                <i class="fas fa-sign-in-alt me-1"></i>Login
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="{{ url_for('register') }}">
                <i class="fas fa-user-plus me-1"></i>Register
              </a>
            </li>
            {% endif %}
          </ul>
        </div>
      </div>
    </nav>

    <!-- Flash Messages -->
    {% with messages = get_flashed_messages(with_categories=true) %} {% if
    messages %}
    <div class="container mt-3">
      {% for category, message in messages %}
      <div
        class="alert alert-{{ 'danger' if category == 'error' else category }} alert-modern alert-dismissible fade show fade-in-up"
        role="alert"
      >
        <i
          class="fas fa-{{ 'exclamation-triangle' if category == 'error' else 'info-circle' if category == 'info' else 'check-circle' if category == 'success' else 'exclamation-triangle' }} me-2"
        ></i>
        {{ message }}
        <button
          type="button"
          class="btn-close"
          data-bs-dismiss="alert"
        ></button>
      </div>
      {% endfor %}
    </div>
    {% endif %} {% endwith %}

    <!-- Main Content -->
    <main class="flex-grow-1">{% block content %}{% endblock %}</main>

    <!-- Footer -->
    <footer class="footer">
      <div class="container">
        <div class="row">
          <div class="col-md-6">
            <h6>
              <i class="fas fa-shield-alt me-2"></i>Face Anti-Spoofing
              Attendance System
            </h6>
            <p class="mb-0">
              Secure attendance management with advanced anti-spoofing
              technology.
            </p>
          </div>
          <div class="col-md-6 text-md-end">
            <p class="mb-0">
              <i class="fas fa-code me-1"></i>
              Built with Flask, PyTorch & MediaPipe
            </p>
            <small class="text-muted">Â© 2025 Face Anti-Spoofing Team</small>
          </div>
        </div>
      </div>
    </footer>

    <!-- Loading Modal -->
    <div
      class="modal fade"
      id="loadingModal"
      tabindex="-1"
      data-bs-backdrop="static"
      data-bs-keyboard="false"
    >
      <div class="modal-dialog modal-dialog-centered modal-sm">
        <div class="modal-content">
          <div class="modal-body text-center py-4">
            <div class="spinner-border text-primary mb-3" role="status">
              <span class="visually-hidden">Loading...</span>
            </div>
            <h6 class="mb-0">Processing...</h6>
            <small class="text-muted">Please wait</small>
          </div>
        </div>
      </div>
    </div>

    <!-- Bootstrap 5 JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Custom JavaScript -->
    <script>
      // Global utilities
      window.showLoading = function () {
        const modal = new bootstrap.Modal(
          document.getElementById("loadingModal")
        );
        modal.show();
      };

      window.hideLoading = function () {
        const modal = bootstrap.Modal.getInstance(
          document.getElementById("loadingModal")
        );
        if (modal) modal.hide();
      };

      // Form submission with loading
      document.addEventListener("DOMContentLoaded", function () {
        const forms = document.querySelectorAll('form[data-loading="true"]');
        forms.forEach((form) => {
          form.addEventListener("submit", function () {
            showLoading();
          });
        });

        // Auto-hide alerts after 5 seconds
        const alerts = document.querySelectorAll(
          ".alert:not(.alert-permanent)"
        );
        alerts.forEach((alert) => {
          setTimeout(() => {
            const bsAlert = new bootstrap.Alert(alert);
            bsAlert.close();
          }, 5000);
        });
      });

      // AJAX helper
      window.makeRequest = async function (url, options = {}) {
        showLoading();

        try {
          const response = await fetch(url, {
            headers: {
              "Content-Type": "application/json",
              ...options.headers,
            },
            ...options,
          });

          const data = await response.json();
          return { success: response.ok, data, status: response.status };
        } catch (error) {
          return { success: false, error: error.message, status: 0 };
        } finally {
          hideLoading();
        }
      };
    </script>

    {% block extra_js %}{% endblock %}
  </body>
</html>
