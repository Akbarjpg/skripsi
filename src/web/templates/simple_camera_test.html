<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Simple Camera Test</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 20px;
        background: #f0f0f0;
      }
      .container {
        max-width: 800px;
        margin: 0 auto;
        background: white;
        padding: 20px;
        border-radius: 10px;
      }
      video {
        width: 100%;
        max-width: 640px;
        border: 2px solid #007bff;
        border-radius: 10px;
      }
      button {
        padding: 15px 30px;
        margin: 10px;
        border: none;
        border-radius: 5px;
        font-size: 16px;
        cursor: pointer;
      }
      .start-btn {
        background: #28a745;
        color: white;
      }
      .stop-btn {
        background: #dc3545;
        color: white;
      }
      .test-btn {
        background: #007bff;
        color: white;
      }
      .status {
        margin: 20px 0;
        padding: 15px;
        background: #f8f9fa;
        border-radius: 5px;
        border-left: 4px solid #007bff;
      }
      .message {
        padding: 8px 12px;
        margin: 5px 0;
        border-radius: 4px;
        background: #d1ecf1;
        color: #0c5460;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>üé• Simple Camera Test</h1>
      <p>Test camera functionality untuk debugging</p>

      <video id="testVideo" autoplay muted playsinline></video>

      <div>
        <button class="start-btn" onclick="startTestCamera()">
          üìπ Start Camera
        </button>
        <button class="stop-btn" onclick="stopTestCamera()">
          ‚èπÔ∏è Stop Camera
        </button>
        <button class="test-btn" onclick="runTest()">üß™ Run Test</button>
      </div>

      <div class="status">
        <h3>Status</h3>
        <div id="status">Ready to test</div>
      </div>

      <div class="status">
        <h3>Messages</h3>
        <div id="messages"></div>
      </div>
    </div>

    <script>
      console.log("Script loaded successfully");

      let testVideo = null;
      let stream = null;

      // Initialize when page loads
      document.addEventListener("DOMContentLoaded", function () {
        console.log("DOM loaded");
        testVideo = document.getElementById("testVideo");
        updateStatus("System ready");
        addTestMessage("System initialized successfully");
      });

      // Global functions accessible from onclick
      window.startTestCamera = async function () {
        console.log("startTestCamera called");
        try {
          updateStatus("Starting camera...");
          addTestMessage("Requesting camera permission...");

          stream = await navigator.mediaDevices.getUserMedia({
            video: {
              width: { ideal: 640 },
              height: { ideal: 480 },
              facingMode: "user",
            },
          });

          testVideo.srcObject = stream;
          updateStatus("Camera active");
          addTestMessage("‚úÖ Camera started successfully!");
        } catch (error) {
          console.error("Camera error:", error);
          updateStatus("Camera error");
          addTestMessage(`‚ùå Camera error: ${error.message}`);
        }
      };

      window.stopTestCamera = function () {
        console.log("stopTestCamera called");
        try {
          if (stream) {
            const tracks = stream.getTracks();
            tracks.forEach((track) => {
              track.stop();
              console.log("Track stopped:", track);
            });
            stream = null;
          }

          testVideo.srcObject = null;
          updateStatus("Camera stopped");
          addTestMessage("‚úÖ Camera stopped successfully");
        } catch (error) {
          console.error("Stop camera error:", error);
          addTestMessage(`‚ùå Stop error: ${error.message}`);
        }
      };

      window.runTest = function () {
        console.log("runTest called");
        updateStatus("Running tests...");
        addTestMessage("üß™ Running system tests...");

        // Test 1: Check video element
        setTimeout(() => {
          if (testVideo) {
            addTestMessage("‚úÖ Video element found");
          } else {
            addTestMessage("‚ùå Video element not found");
          }
        }, 500);

        // Test 2: Check MediaDevices API
        setTimeout(() => {
          if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
            addTestMessage("‚úÖ MediaDevices API available");
          } else {
            addTestMessage("‚ùå MediaDevices API not available");
          }
        }, 1000);

        // Test 3: Check permissions
        setTimeout(() => {
          navigator.permissions
            .query({ name: "camera" })
            .then(function (result) {
              addTestMessage(`‚úÖ Camera permission: ${result.state}`);
            })
            .catch(function (error) {
              addTestMessage(`‚ö†Ô∏è Permission check failed: ${error.message}`);
            });
        }, 1500);

        setTimeout(() => {
          updateStatus("Tests completed");
          addTestMessage("üéâ All tests completed!");
        }, 2000);
      };

      function updateStatus(message) {
        document.getElementById("status").textContent = message;
      }

      function addTestMessage(message) {
        const messagesDiv = document.getElementById("messages");
        const messageDiv = document.createElement("div");
        messageDiv.className = "message";
        messageDiv.innerHTML = `[${new Date().toLocaleTimeString()}] ${message}`;
        messagesDiv.appendChild(messageDiv);

        // Auto scroll
        messagesDiv.scrollTop = messagesDiv.scrollHeight;
      }

      // Test that functions are properly defined
      console.log("startTestCamera function:", typeof window.startTestCamera);
      console.log("stopTestCamera function:", typeof window.stopTestCamera);
      console.log("runTest function:", typeof window.runTest);
    </script>
  </body>
</html>
